{"ast":null,"code":"var _jsxFileName = \"/home/krishnansh/Documents/WebDev/PS/notus-react-main/src/views/admin/Map.js\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport \"@tomtom-international/web-sdk-maps/dist/maps.css\";\nimport * as ttservices from \"@tomtom-international/web-sdk-services\";\nimport tt from \"@tomtom-international/web-sdk-maps\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { api_key } from \"constants.js\";\nimport \"../../App.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Map(_ref) {\n  _s();\n  let {\n    currLocation,\n    deliveryLocation,\n    destinations,\n    zoom_level,\n    travel_mode,\n    setOpen,\n    setMarkerSelected\n  } = _ref;\n  const mapElement = useRef();\n  const [map, setMap] = useState(null);\n  const [waypoints] = useState(destinations);\n  function handleMarkerClick(e) {\n    setOpen(\"true\");\n    setMarkerSelected(1); //setMarkerSelected(marker_id) TBD\n    console.log(e.target);\n  }\n  function handleMarkerDeselect(e) {\n    console.log(\"deselect\");\n  }\n  function create_delivery_marker(location) {\n    const marker_el = document.createElement(\"div\");\n    marker_el.id = location.markerI;\n    marker_el.className = 'marker-delivery';\n    const popup = new tt.Popup({\n      offset: 20\n    }).setHTML(`Location Number:${location.markerId}`);\n    const marker = new tt.Marker({\n      id: location.markerId,\n      element: marker_el,\n      anchor: \"bottom\"\n    }).setLngLat([location.lng, location.lat]).addTo(map).setPopup(popup);\n    // .onClose(handleMarkerDeselect);\n    marker_el.addEventListener('click', e => handleMarkerClick(e));\n    return marker;\n  }\n  function create_driver_marker(location) {\n    const marker_el = document.createElement(\"div\");\n    marker_el.className = 'marker-driver';\n    const marker = new tt.Marker({\n      element: marker_el,\n      anchor: \"bottom\"\n    }).setLngLat([location.lng, location.lat]).addTo(map);\n    return marker;\n  }\n  const create_route = (locations, i) => {\n    ttservices.services.calculateRoute({\n      key: api_key,\n      locations\n    }).then(routeData => {\n      const features = routeData.toGeoJson().features;\n      features.forEach((feature, index) => {\n        map.addLayer({\n          id: \"route\" + i + index,\n          type: \"line\",\n          source: {\n            type: \"geojson\",\n            data: feature\n          },\n          paint: {\n            \"line-color\": `red`,\n            \"line-opacity\": 0.8,\n            \"line-width\": 6,\n            \"line-dasharray\": [1, 0, 1, 0]\n          }\n        });\n      });\n    });\n  };\n  useEffect(() => {\n    let map = tt.map({\n      key: api_key,\n      container: mapElement.current,\n      center: [77.5747463, 12.9140182],\n      zoom: zoom_level\n    });\n    map.addControl(new tt.FullscreenControl());\n    map.addControl(new tt.NavigationControl());\n    setMap(map);\n    return () => map.remove();\n  }, []);\n  useEffect(() => {\n    if (map) {\n      map.on(\"load\", () => {\n        waypoints.forEach(location => {\n          create_delivery_marker(location);\n        });\n        create_driver_marker(currLocation);\n        const locations = waypoints.map(location => [location.lng, location.lat]);\n        for (let i = 0; i < locations.length; i += 150) {\n          if (i + 150 > locations.length) {\n            create_route(locations.slice(i), i);\n          }\n          create_route(locations.slice(i, i + 150), i);\n        }\n      });\n    } else {\n      console.log(\"error loading map\"); //Add better error handling function\n    }\n  }, [map, waypoints]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"map_wrapper\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapElement,\n      style: {\n        position: 'absolute',\n        top: 0,\n        bottom: 0,\n        left: 0,\n        right: 0,\n        width: '100%',\n        height: '100%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 5\n  }, this);\n}\n_s(Map, \"IYIj7oX3i+wKJgPiJXmWtFJH5qM=\");\n_c = Map;\nexport default Map;\nvar _c;\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"names":["React","ttservices","tt","useEffect","useState","useRef","api_key","Map","currLocation","deliveryLocation","destinations","zoom_level","travel_mode","setOpen","setMarkerSelected","mapElement","map","setMap","waypoints","handleMarkerClick","e","console","log","target","handleMarkerDeselect","create_delivery_marker","location","marker_el","document","createElement","id","markerI","className","popup","Popup","offset","setHTML","markerId","marker","Marker","element","anchor","setLngLat","lng","lat","addTo","setPopup","addEventListener","create_driver_marker","create_route","locations","i","services","calculateRoute","key","then","routeData","features","toGeoJson","forEach","feature","index","addLayer","type","source","data","paint","container","current","center","zoom","addControl","FullscreenControl","NavigationControl","remove","on","length","slice","position","top","bottom","left","right","width","height"],"sources":["/home/krishnansh/Documents/WebDev/PS/notus-react-main/src/views/admin/Map.js"],"sourcesContent":["import React from 'react'\nimport \"@tomtom-international/web-sdk-maps/dist/maps.css\";\nimport * as ttservices from \"@tomtom-international/web-sdk-services\";\nimport tt from \"@tomtom-international/web-sdk-maps\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { api_key } from \"constants.js\"\nimport \"../../App.css\"\n\nfunction Map({ currLocation, deliveryLocation, destinations, zoom_level, travel_mode,setOpen,setMarkerSelected }) {\n  const mapElement = useRef();\n  const [map, setMap] = useState(null);\n  const [waypoints] = useState(destinations);\n  \n  function handleMarkerClick(e){\n    setOpen(\"true\");\n    setMarkerSelected(1); //setMarkerSelected(marker_id) TBD\n    console.log(e.target);\n  }\n\n  function handleMarkerDeselect(e){\n    console.log(\"deselect\");\n  }\n\n  function create_delivery_marker(location) {\n    const marker_el = document.createElement(\"div\");\n    marker_el.id = location.markerI\n    marker_el.className = 'marker-delivery';\n    const popup = new tt.Popup({ offset: 20 }).setHTML(\n      `Location Number:${location.markerId}`\n    );\n    const marker = new tt.Marker({ id:location.markerId, element: marker_el, anchor: \"bottom\" })\n      .setLngLat([location.lng, location.lat])\n      .addTo(map)\n      .setPopup(popup)\n      // .onClose(handleMarkerDeselect);\n    marker_el.addEventListener('click',(e)=>handleMarkerClick(e));\n    return marker;\n  }\n\n  function create_driver_marker(location) {\n    const marker_el = document.createElement(\"div\");\n    marker_el.className = 'marker-driver';\n    const marker = new tt.Marker({ element: marker_el, anchor: \"bottom\" })\n      .setLngLat([location.lng, location.lat])\n      .addTo(map);\n\n    return marker;\n  }\n\n  const create_route = (locations, i) => {\n    ttservices.services\n      .calculateRoute({\n        key: api_key,\n        locations,\n      })\n      .then((routeData) => {\n        const features = routeData.toGeoJson().features;\n        features.forEach((feature, index) => {\n          map.addLayer({\n            id: \"route\" + i + index,\n            type: \"line\",\n            source: {\n              type: \"geojson\",\n              data: feature,\n            },\n            paint: {\n              \"line-color\": `red`,\n              \"line-opacity\": 0.8,\n              \"line-width\": 6,\n              \"line-dasharray\": [1, 0, 1, 0],\n            }\n          });\n        });\n      });\n  };\n\n  useEffect(() => {\n    let map = tt.map({\n      key: api_key,\n      container: mapElement.current,\n      center: [77.5747463, 12.9140182],\n      zoom: zoom_level,\n    });\n    map.addControl(new tt.FullscreenControl());\n    map.addControl(new tt.NavigationControl());\n    setMap(map);\n    return () => map.remove();\n  }, []);\n\n  useEffect(() => {\n    if (map) {\n      map.on(\"load\", () => {\n        waypoints.forEach((location) => {\n          create_delivery_marker(location);\n        });\n        create_driver_marker(currLocation);\n        const locations = waypoints.map((location) => [location.lng, location.lat])\n\n        for (let i = 0; i < locations.length; i += 150) {\n          if (i + 150 > locations.length) {\n            create_route(locations.slice(i), i)\n          }\n          create_route(locations.slice(i, i + 150), i)\n        }\n      });\n    }\n    else {\n      console.log(\"error loading map\"); //Add better error handling function\n    }\n  },[map,waypoints]);\n\n  return (\n    <div className=\"map_wrapper\">\n      <div\n        ref={mapElement}\n        style={{\n          position: 'absolute',\n          top: 0,\n          bottom: 0,\n          left: 0,\n          right: 0,\n          width: '100%',\n          height: '100%'\n        }}\n      />\n    </div>\n  );\n}\nexport default Map;"],"mappings":"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"},"metadata":{},"sourceType":"module"}